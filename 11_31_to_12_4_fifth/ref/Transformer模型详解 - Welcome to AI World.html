<!DOCTYPE html>
<html><head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Transformer模型详解 - Welcome to AI World</title>
    <meta name="author" content="Joe">
    <meta name="description" content="Transformer模型详解">
    <meta name="keywords" content="NLP">
    <!-- Open Graph -->
    <meta property="og:title" content="Transformer模型详解 - Welcome to AI World">
    <meta property="og:type" content="website">
    <meta property="og:url" content="/2019/01/11/Transformer%E6%A8%A1%E5%9E%8B%E8%AF%A6%E8%A7%A3.html">
    <meta property="og:description" content="个人AI技术博客">
    <meta property="og:site_name" content="Welcome to AI World">
    <link rel="stylesheet" href="Transformer%E6%A8%A1%E5%9E%8B%E8%AF%A6%E8%A7%A3%20-%20Welcome%20to%20AI%20World_files/normalize.css">
    <link rel="stylesheet" href="Transformer%E6%A8%A1%E5%9E%8B%E8%AF%A6%E8%A7%A3%20-%20Welcome%20to%20AI%20World_files/font_roc50gemkxpw4s4i.css">
    <link rel="stylesheet" href="Transformer%E6%A8%A1%E5%9E%8B%E8%AF%A6%E8%A7%A3%20-%20Welcome%20to%20AI%20World_files/github-markdown.css">
    <link rel="stylesheet" href="Transformer%E6%A8%A1%E5%9E%8B%E8%AF%A6%E8%A7%A3%20-%20Welcome%20to%20AI%20World_files/prism.css">
    <link rel="stylesheet" href="Transformer%E6%A8%A1%E5%9E%8B%E8%AF%A6%E8%A7%A3%20-%20Welcome%20to%20AI%20World_files/share.css">
    <link rel="stylesheet" href="Transformer%E6%A8%A1%E5%9E%8B%E8%AF%A6%E8%A7%A3%20-%20Welcome%20to%20AI%20World_files/app.css">
    <script src="Transformer%E6%A8%A1%E5%9E%8B%E8%AF%A6%E8%A7%A3%20-%20Welcome%20to%20AI%20World_files/embed.js" async=""></script><script src="Transformer%E6%A8%A1%E5%9E%8B%E8%AF%A6%E8%A7%A3%20-%20Welcome%20to%20AI%20World_files/jquery.js"></script>
<style type="text/css">.MathJax_Hover_Frame {border-radius: .25em; -webkit-border-radius: .25em; -moz-border-radius: .25em; -khtml-border-radius: .25em; box-shadow: 0px 0px 15px #83A; -webkit-box-shadow: 0px 0px 15px #83A; -moz-box-shadow: 0px 0px 15px #83A; -khtml-box-shadow: 0px 0px 15px #83A; border: 1px solid #A6D ! important; display: inline-block; position: absolute}
.MathJax_Menu_Button .MathJax_Hover_Arrow {position: absolute; cursor: pointer; display: inline-block; border: 2px solid #AAA; border-radius: 4px; -webkit-border-radius: 4px; -moz-border-radius: 4px; -khtml-border-radius: 4px; font-family: 'Courier New',Courier; font-size: 9px; color: #F0F0F0}
.MathJax_Menu_Button .MathJax_Hover_Arrow span {display: block; background-color: #AAA; border: 1px solid; border-radius: 3px; line-height: 0; padding: 4px}
.MathJax_Hover_Arrow:hover {color: white!important; border: 2px solid #CCC!important}
.MathJax_Hover_Arrow:hover span {background-color: #CCC!important}
</style><style type="text/css">#MathJax_About {position: fixed; left: 50%; width: auto; text-align: center; border: 3px outset; padding: 1em 2em; background-color: #DDDDDD; color: black; cursor: default; font-family: message-box; font-size: 120%; font-style: normal; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; z-index: 201; border-radius: 15px; -webkit-border-radius: 15px; -moz-border-radius: 15px; -khtml-border-radius: 15px; box-shadow: 0px 10px 20px #808080; -webkit-box-shadow: 0px 10px 20px #808080; -moz-box-shadow: 0px 10px 20px #808080; -khtml-box-shadow: 0px 10px 20px #808080; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
#MathJax_About.MathJax_MousePost {outline: none}
.MathJax_Menu {position: absolute; background-color: white; color: black; width: auto; padding: 2px; border: 1px solid #CCCCCC; margin: 0; cursor: default; font: menu; text-align: left; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; z-index: 201; box-shadow: 0px 10px 20px #808080; -webkit-box-shadow: 0px 10px 20px #808080; -moz-box-shadow: 0px 10px 20px #808080; -khtml-box-shadow: 0px 10px 20px #808080; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
.MathJax_MenuItem {padding: 2px 2em; background: transparent}
.MathJax_MenuArrow {position: absolute; right: .5em; padding-top: .25em; color: #666666; font-size: .75em}
.MathJax_MenuActive .MathJax_MenuArrow {color: white}
.MathJax_MenuArrow.RTL {left: .5em; right: auto}
.MathJax_MenuCheck {position: absolute; left: .7em}
.MathJax_MenuCheck.RTL {right: .7em; left: auto}
.MathJax_MenuRadioCheck {position: absolute; left: 1em}
.MathJax_MenuRadioCheck.RTL {right: 1em; left: auto}
.MathJax_MenuLabel {padding: 2px 2em 4px 1.33em; font-style: italic}
.MathJax_MenuRule {border-top: 1px solid #CCCCCC; margin: 4px 1px 0px}
.MathJax_MenuDisabled {color: GrayText}
.MathJax_MenuActive {background-color: Highlight; color: HighlightText}
.MathJax_MenuDisabled:focus, .MathJax_MenuLabel:focus {background-color: #E8E8E8}
.MathJax_ContextMenu:focus {outline: none}
.MathJax_ContextMenu .MathJax_MenuItem:focus {outline: none}
#MathJax_AboutClose {top: .2em; right: .2em}
.MathJax_Menu .MathJax_MenuClose {top: -10px; left: -10px}
.MathJax_MenuClose {position: absolute; cursor: pointer; display: inline-block; border: 2px solid #AAA; border-radius: 18px; -webkit-border-radius: 18px; -moz-border-radius: 18px; -khtml-border-radius: 18px; font-family: 'Courier New',Courier; font-size: 24px; color: #F0F0F0}
.MathJax_MenuClose span {display: block; background-color: #AAA; border: 1.5px solid; border-radius: 18px; -webkit-border-radius: 18px; -moz-border-radius: 18px; -khtml-border-radius: 18px; line-height: 0; padding: 8px 0 6px}
.MathJax_MenuClose:hover {color: white!important; border: 2px solid #CCC!important}
.MathJax_MenuClose:hover span {background-color: #CCC!important}
.MathJax_MenuClose:hover:focus {outline: none}
</style><style type="text/css">.MathJax_Preview .MJXf-math {color: inherit!important}
</style><style type="text/css">.MJX_Assistive_MathML {position: absolute!important; top: 0; left: 0; clip: rect(1px, 1px, 1px, 1px); padding: 1px 0 0 0!important; border: 0!important; height: 1px!important; width: 1px!important; overflow: hidden!important; display: block!important; -webkit-touch-callout: none; -webkit-user-select: none; -khtml-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none}
.MJX_Assistive_MathML.MJX_Assistive_MathML_Block {width: 100%!important}
</style><style type="text/css">#MathJax_Zoom {position: absolute; background-color: #F0F0F0; overflow: auto; display: block; z-index: 301; padding: .5em; border: 1px solid black; margin: 0; font-weight: normal; font-style: normal; text-align: left; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; -webkit-box-sizing: content-box; -moz-box-sizing: content-box; box-sizing: content-box; box-shadow: 5px 5px 15px #AAAAAA; -webkit-box-shadow: 5px 5px 15px #AAAAAA; -moz-box-shadow: 5px 5px 15px #AAAAAA; -khtml-box-shadow: 5px 5px 15px #AAAAAA; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
#MathJax_ZoomOverlay {position: absolute; left: 0; top: 0; z-index: 300; display: inline-block; width: 100%; height: 100%; border: 0; padding: 0; margin: 0; background-color: white; opacity: 0; filter: alpha(opacity=0)}
#MathJax_ZoomFrame {position: relative; display: inline-block; height: 0; width: 0}
#MathJax_ZoomEventTrap {position: absolute; left: 0; top: 0; z-index: 302; display: inline-block; border: 0; padding: 0; margin: 0; background-color: white; opacity: 0; filter: alpha(opacity=0)}
</style><style type="text/css">.MathJax_Preview {color: #888}
#MathJax_Message {position: fixed; left: 1px; bottom: 2px; background-color: #E6E6E6; border: 1px solid #959595; margin: 0px; padding: 2px 8px; z-index: 102; color: black; font-size: 80%; width: auto; white-space: nowrap}
#MathJax_MSIE_Frame {position: absolute; top: 0; left: 0; width: 0px; z-index: 101; border: 0px; margin: 0px; padding: 0px}
.MathJax_Error {color: #CC0000; font-style: italic}
</style><style type="text/css">.MJXp-script {font-size: .8em}
.MJXp-right {-webkit-transform-origin: right; -moz-transform-origin: right; -ms-transform-origin: right; -o-transform-origin: right; transform-origin: right}
.MJXp-bold {font-weight: bold}
.MJXp-italic {font-style: italic}
.MJXp-scr {font-family: MathJax_Script,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-frak {font-family: MathJax_Fraktur,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-sf {font-family: MathJax_SansSerif,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-cal {font-family: MathJax_Caligraphic,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-mono {font-family: MathJax_Typewriter,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-largeop {font-size: 150%}
.MJXp-largeop.MJXp-int {vertical-align: -.2em}
.MJXp-math {display: inline-block; line-height: 1.2; text-indent: 0; font-family: 'Times New Roman',Times,STIXGeneral,serif; white-space: nowrap; border-collapse: collapse}
.MJXp-display {display: block; text-align: center; margin: 1em 0}
.MJXp-math span {display: inline-block}
.MJXp-box {display: block!important; text-align: center}
.MJXp-box:after {content: " "}
.MJXp-rule {display: block!important; margin-top: .1em}
.MJXp-char {display: block!important}
.MJXp-mo {margin: 0 .15em}
.MJXp-mfrac {margin: 0 .125em; vertical-align: .25em}
.MJXp-denom {display: inline-table!important; width: 100%}
.MJXp-denom > * {display: table-row!important}
.MJXp-surd {vertical-align: top}
.MJXp-surd > * {display: block!important}
.MJXp-script-box > *  {display: table!important; height: 50%}
.MJXp-script-box > * > * {display: table-cell!important; vertical-align: top}
.MJXp-script-box > *:last-child > * {vertical-align: bottom}
.MJXp-script-box > * > * > * {display: block!important}
.MJXp-mphantom {visibility: hidden}
.MJXp-munderover {display: inline-table!important}
.MJXp-over {display: inline-block!important; text-align: center}
.MJXp-over > * {display: block!important}
.MJXp-munderover > * {display: table-row!important}
.MJXp-mtable {vertical-align: .25em; margin: 0 .125em}
.MJXp-mtable > * {display: inline-table!important; vertical-align: middle}
.MJXp-mtr {display: table-row!important}
.MJXp-mtd {display: table-cell!important; text-align: center; padding: .5em 0 0 .5em}
.MJXp-mtr > .MJXp-mtd:first-child {padding-left: 0}
.MJXp-mtr:first-child > .MJXp-mtd {padding-top: 0}
.MJXp-mlabeledtr {display: table-row!important}
.MJXp-mlabeledtr > .MJXp-mtd:first-child {padding-left: 0}
.MJXp-mlabeledtr:first-child > .MJXp-mtd {padding-top: 0}
.MJXp-merror {background-color: #FFFF88; color: #CC0000; border: 1px solid #CC0000; padding: 1px 3px; font-style: normal; font-size: 90%}
.MJXp-scale0 {-webkit-transform: scaleX(.0); -moz-transform: scaleX(.0); -ms-transform: scaleX(.0); -o-transform: scaleX(.0); transform: scaleX(.0)}
.MJXp-scale1 {-webkit-transform: scaleX(.1); -moz-transform: scaleX(.1); -ms-transform: scaleX(.1); -o-transform: scaleX(.1); transform: scaleX(.1)}
.MJXp-scale2 {-webkit-transform: scaleX(.2); -moz-transform: scaleX(.2); -ms-transform: scaleX(.2); -o-transform: scaleX(.2); transform: scaleX(.2)}
.MJXp-scale3 {-webkit-transform: scaleX(.3); -moz-transform: scaleX(.3); -ms-transform: scaleX(.3); -o-transform: scaleX(.3); transform: scaleX(.3)}
.MJXp-scale4 {-webkit-transform: scaleX(.4); -moz-transform: scaleX(.4); -ms-transform: scaleX(.4); -o-transform: scaleX(.4); transform: scaleX(.4)}
.MJXp-scale5 {-webkit-transform: scaleX(.5); -moz-transform: scaleX(.5); -ms-transform: scaleX(.5); -o-transform: scaleX(.5); transform: scaleX(.5)}
.MJXp-scale6 {-webkit-transform: scaleX(.6); -moz-transform: scaleX(.6); -ms-transform: scaleX(.6); -o-transform: scaleX(.6); transform: scaleX(.6)}
.MJXp-scale7 {-webkit-transform: scaleX(.7); -moz-transform: scaleX(.7); -ms-transform: scaleX(.7); -o-transform: scaleX(.7); transform: scaleX(.7)}
.MJXp-scale8 {-webkit-transform: scaleX(.8); -moz-transform: scaleX(.8); -ms-transform: scaleX(.8); -o-transform: scaleX(.8); transform: scaleX(.8)}
.MJXp-scale9 {-webkit-transform: scaleX(.9); -moz-transform: scaleX(.9); -ms-transform: scaleX(.9); -o-transform: scaleX(.9); transform: scaleX(.9)}
.MathJax_PHTML .noError {vertical-align: ; font-size: 90%; text-align: left; color: black; padding: 1px 3px; border: 1px solid}
</style><style type="text/css">.MathJax_Display {text-align: center; margin: 1em 0em; position: relative; display: block!important; text-indent: 0; max-width: none; max-height: none; min-width: 0; min-height: 0; width: 100%}
.MathJax .merror {background-color: #FFFF88; color: #CC0000; border: 1px solid #CC0000; padding: 1px 3px; font-style: normal; font-size: 90%}
.MathJax .MJX-monospace {font-family: monospace}
.MathJax .MJX-sans-serif {font-family: sans-serif}
#MathJax_Tooltip {background-color: InfoBackground; color: InfoText; border: 1px solid black; box-shadow: 2px 2px 5px #AAAAAA; -webkit-box-shadow: 2px 2px 5px #AAAAAA; -moz-box-shadow: 2px 2px 5px #AAAAAA; -khtml-box-shadow: 2px 2px 5px #AAAAAA; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true'); padding: 3px 4px; z-index: 401; position: absolute; left: 0; top: 0; width: auto; height: auto; display: none}
.MathJax {display: inline; font-style: normal; font-weight: normal; line-height: normal; font-size: 100%; font-size-adjust: none; text-indent: 0; text-align: left; text-transform: none; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; direction: ltr; max-width: none; max-height: none; min-width: 0; min-height: 0; border: 0; padding: 0; margin: 0}
.MathJax:focus, body :focus .MathJax {display: inline-table}
.MathJax.MathJax_FullWidth {text-align: center; display: table-cell!important; width: 10000em!important}
.MathJax img, .MathJax nobr, .MathJax a {border: 0; padding: 0; margin: 0; max-width: none; max-height: none; min-width: 0; min-height: 0; vertical-align: 0; line-height: normal; text-decoration: none}
img.MathJax_strut {border: 0!important; padding: 0!important; margin: 0!important; vertical-align: 0!important}
.MathJax span {display: inline; position: static; border: 0; padding: 0; margin: 0; vertical-align: 0; line-height: normal; text-decoration: none}
.MathJax nobr {white-space: nowrap!important}
.MathJax img {display: inline!important; float: none!important}
.MathJax * {transition: none; -webkit-transition: none; -moz-transition: none; -ms-transition: none; -o-transition: none}
.MathJax_Processing {visibility: hidden; position: fixed; width: 0; height: 0; overflow: hidden}
.MathJax_Processed {display: none!important}
.MathJax_ExBox {display: block!important; overflow: hidden; width: 1px; height: 60ex; min-height: 0; max-height: none}
.MathJax .MathJax_EmBox {display: block!important; overflow: hidden; width: 1px; height: 60em; min-height: 0; max-height: none}
.MathJax_LineBox {display: table!important}
.MathJax_LineBox span {display: table-cell!important; width: 10000em!important; min-width: 0; max-width: none; padding: 0; border: 0; margin: 0}
.MathJax .MathJax_HitBox {cursor: text; background: white; opacity: 0; filter: alpha(opacity=0)}
.MathJax .MathJax_HitBox * {filter: none; opacity: 1; background: transparent}
#MathJax_Tooltip * {filter: none; opacity: 1; background: transparent}
@font-face {font-family: MathJax_Main; src: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/fonts/HTML-CSS/TeX/woff/MathJax_Main-Regular.woff?V=2.7.0') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/fonts/HTML-CSS/TeX/otf/MathJax_Main-Regular.otf?V=2.7.0') format('opentype')}
@font-face {font-family: MathJax_Main; src: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/fonts/HTML-CSS/TeX/woff/MathJax_Main-Bold.woff?V=2.7.0') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/fonts/HTML-CSS/TeX/otf/MathJax_Main-Bold.otf?V=2.7.0') format('opentype'); font-weight: bold}
@font-face {font-family: MathJax_Main; src: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/fonts/HTML-CSS/TeX/woff/MathJax_Main-Italic.woff?V=2.7.0') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/fonts/HTML-CSS/TeX/otf/MathJax_Main-Italic.otf?V=2.7.0') format('opentype'); font-style: italic}
@font-face {font-family: MathJax_Math; src: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/fonts/HTML-CSS/TeX/woff/MathJax_Math-Italic.woff?V=2.7.0') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/fonts/HTML-CSS/TeX/otf/MathJax_Math-Italic.otf?V=2.7.0') format('opentype'); font-style: italic}
@font-face {font-family: MathJax_Caligraphic; src: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/fonts/HTML-CSS/TeX/woff/MathJax_Caligraphic-Regular.woff?V=2.7.0') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/fonts/HTML-CSS/TeX/otf/MathJax_Caligraphic-Regular.otf?V=2.7.0') format('opentype')}
@font-face {font-family: MathJax_Size1; src: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/fonts/HTML-CSS/TeX/woff/MathJax_Size1-Regular.woff?V=2.7.0') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/fonts/HTML-CSS/TeX/otf/MathJax_Size1-Regular.otf?V=2.7.0') format('opentype')}
@font-face {font-family: MathJax_Size2; src: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/fonts/HTML-CSS/TeX/woff/MathJax_Size2-Regular.woff?V=2.7.0') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/fonts/HTML-CSS/TeX/otf/MathJax_Size2-Regular.otf?V=2.7.0') format('opentype')}
@font-face {font-family: MathJax_Size3; src: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/fonts/HTML-CSS/TeX/woff/MathJax_Size3-Regular.woff?V=2.7.0') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/fonts/HTML-CSS/TeX/otf/MathJax_Size3-Regular.otf?V=2.7.0') format('opentype')}
@font-face {font-family: MathJax_Size4; src: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/fonts/HTML-CSS/TeX/woff/MathJax_Size4-Regular.woff?V=2.7.0') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/fonts/HTML-CSS/TeX/otf/MathJax_Size4-Regular.otf?V=2.7.0') format('opentype')}
.MathJax .noError {vertical-align: ; font-size: 90%; text-align: left; color: black; padding: 1px 3px; border: 1px solid}
</style></head>


<body><div style="visibility: hidden; overflow: hidden; position: absolute; top: 0px; height: 1px; width: auto; padding: 0px; border: 0px none; margin: 0px; text-align: left; text-indent: 0px; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal;"><div id="MathJax_Hidden"></div></div><div id="MathJax_Message" style="display: none;"></div>
  <!--[if lt IE 10]>
<div class="alert-danger" role="alert">你的浏览器实在太太太旧了，放学别走，升级完浏览器再说！<a target="_blank" class="alert-link" href="http://browsehappy.com">立即升级</a></div>
<![endif]-->
  <input id="nm-switch" type="hidden" value="true"> <header class="g-header">
    <div class="g-logo">
      <a href="https://terrifyzhao.github.io/"></a>
    </div>
    <i id="menu-toggle" class="iconfont icon-menu"></i>
    <nav class="g-nav">
        <ul>
            
            <li><a href="https://terrifyzhao.github.io/">home</a></li>
            
            <li><a href="https://terrifyzhao.github.io/tags.html">tags</a></li>
            
        </ul>
    </nav>
</header>


  <header class="g-banner post-header post-pattern-circuitBoard bgcolor-default " data-theme="default">
    <div class="post-wrapper">
      <div class="post-tags">
        
          
            <a href="https://terrifyzhao.github.io/tags#NLP" class="post-tag">NLP</a>
          
        
      </div>
      <h1>Transformer模型详解</h1>
      <div class="post-meta">
        <span class="post-meta-item"><i class="iconfont icon-author"></i><a href="" target="_blank" rel="author">Joe</a></span>
        <time class="post-meta-item" datetime="19-01-11"><i class="iconfont icon-date"></i>11 Jan 2019</time>
      </div>
    </div>
    
    <div class="filter"></div>
    <div class="post-cover" style="background: url('https://raw.githubusercontent.com/terrifyzhao/terrifyzhao.github.io/master/assets/img/2019-01-06-Transformer%E6%A8%A1%E5%9E%8B%E8%AF%A6%E8%A7%A3/cover.jpg') center no-repeat; background-size: cover;">
      
  </div></header>

  <div class="post-content visible">
    
    <h2 class="post-subtitle">Transformer模型详解</h2>
    

    <article class="markdown-body">
      <h2 id="简介"><strong>简介</strong></h2>

<p><a href="https://arxiv.org/pdf/1706.03762.pdf">Attention Is All You Need</a>是
一篇Google提出的将Attention思想发挥到极致的论文。这篇论文中提出一个全新的模型，叫 
Transformer，抛弃了以往深度学习任务里面使用到的 CNN 和 RNN 
，目前大热的Bert就是基于Transformer构建的，这个模型广泛应用于NLP领域，例如机器翻译，问答系统，文本摘要和语音识别等等方向。</p>

<h2 id="transformer总体结构"><strong>Transformer总体结构</strong></h2>

<p>和Attention模型一样，Transformer模型中也采用了 encoer-decoder 架构。但其结构相比于Attention更加复杂，论文中encoder层由6个encoder堆叠在一起，decoder层也一样。</p>

<p><img src="Transformer%E6%A8%A1%E5%9E%8B%E8%AF%A6%E8%A7%A3%20-%20Welcome%20to%20AI%20World_files/pic1.png" alt=""></p>

<p>每一个encoder和decoder的内部简版结构如下图</p>

<p><img src="Transformer%E6%A8%A1%E5%9E%8B%E8%AF%A6%E8%A7%A3%20-%20Welcome%20to%20AI%20World_files/pic2.png" alt=""></p>

<p>对于encoder，包含两层，一个self-attention层和一个前馈神经网络，self-attention能帮助当前节点不仅仅只关注当前的词，从而能获取到上下文的语义。</p>

<p>decoder也包含encoder提到的两层网络，但是在这两层中间还有一层attention层，帮助当前节点获取到当前需要关注的重点内容。</p>

<p>现在我们知道了模型的主要组件，接下来我们看下模型的内部细节。首先，模型需要对输入的数据进行一个embedding操作，也可以理解为类似
w2c的操作，enmbedding结束之后，输入到encoder层，self-attention处理完数据后把数据送给前馈神经网络，前馈神经网络
的计算可以并行，得到的输出会输入到下一个encoder。</p>

<p><img src="Transformer%E6%A8%A1%E5%9E%8B%E8%AF%A6%E8%A7%A3%20-%20Welcome%20to%20AI%20World_files/pic3.png" alt=""></p>

<h2 id="self-attention"><strong>Self-Attention</strong></h2>
<p>接下来我们详细看一下self-attention，其思想和attention类似，但是self-attention是Transformer用来将其他相关单词的“理解”转换成我们正在处理的单词的一种思路，我们看个例子：
<code class="highlighter-rouge">The animal didn't cross the street because it was too tired</code>
这里的it到底代表的是animal还是street呢，对于我们来说能很简单的判断出来，但是对于机器来说，是很难判断的，self-attention就能够让机器把it和animal联系起来，接下来我们看下详细的处理过程。</p>

<p>1、首先，self-attention会计算出三个新的向量，在论文中，向量的维度是512维，我们把这三个向量分别称为Query、Key、
Value，这三个向量是用embedding向量与一个矩阵相乘得到的结果，这个矩阵是随机初始化的，维度为（64，512）注意第二个维度需要和
embedding的维度一样，其值在BP的过程中会一直进行更新，得到的这三个向量的维度是64低于embedding维度的。</p>

<p><img src="Transformer%E6%A8%A1%E5%9E%8B%E8%AF%A6%E8%A7%A3%20-%20Welcome%20to%20AI%20World_files/pic4.png" alt=""></p>

<p>那么Query、Key、Value这三个向量又是什么呢？这三个向量对于attention来说很重要，当你理解了下文后，你将会明白这三个向量扮演者什么的角色。</p>

<p>2、计算self-attention的分数值，该分数值决定了当我们在某个位置encode一个词时，对输入句子的其他部分的关注程度。这个分数
值的计算方法是Query与Key做点成，以下图为例，首先我们需要针对Thinking这个词，计算出其他词对于该词的一个分数值，首先是针对于自己本
身即q1·k1，然后是针对于第二个词即q1·k2</p>

<p><img src="Transformer%E6%A8%A1%E5%9E%8B%E8%AF%A6%E8%A7%A3%20-%20Welcome%20to%20AI%20World_files/pic5.png" alt=""></p>

<p>3、接下来，把点成的结果除以一个常数，这里我们除以8，这个值一般是采用上文提到的矩阵的第一个维度的开方即64的开方8，当然也可以选择其他的
值，然后把得到的结果做一个softmax的计算。得到的结果即是每个词对于当前位置的词的相关性大小，当然，当前位置的词相关性肯定会会很大</p>

<p><img src="Transformer%E6%A8%A1%E5%9E%8B%E8%AF%A6%E8%A7%A3%20-%20Welcome%20to%20AI%20World_files/pic6.png" alt=""></p>

<p>4、下一步就是把Value和softmax得到的值进行相乘，并相加，得到的结果即是self-attetion在当前节点的值。</p>

<p><img src="Transformer%E6%A8%A1%E5%9E%8B%E8%AF%A6%E8%A7%A3%20-%20Welcome%20to%20AI%20World_files/pic7.png" alt=""></p>

<p>在实际的应用场景，为了提高计算速度，我们采用的是矩阵的方式，直接计算出Query, Key, Value的矩阵，然后把embedding的值与三个矩阵直接相乘，把得到的新矩阵Q与K相乘，乘以一个常数，做softmax操作，最后乘上V矩阵</p>

<p><img src="Transformer%E6%A8%A1%E5%9E%8B%E8%AF%A6%E8%A7%A3%20-%20Welcome%20to%20AI%20World_files/pic8.png" alt=""></p>

<p><img src="Transformer%E6%A8%A1%E5%9E%8B%E8%AF%A6%E8%A7%A3%20-%20Welcome%20to%20AI%20World_files/pic9.png" alt=""></p>

<p>这种通过 query 和 key 的相似性程度来确定 value 的权重分布的方法被称为scaled dot-product attention。</p>

<h2 id="multi-headed-attention"><strong>Multi-Headed Attention</strong></h2>
<p>这篇论文更牛逼的地方是给self-attention加入了另外一个机制，被称为“multi-headed” 
attention，该机制理解起来很简单，就是说不仅仅只初始化一组Q、K、V的矩阵，而是初始化多组，tranformer是使用了8组，所以最后得
到的结果是8个矩阵。</p>

<p><img src="Transformer%E6%A8%A1%E5%9E%8B%E8%AF%A6%E8%A7%A3%20-%20Welcome%20to%20AI%20World_files/pic10.png" alt=""></p>

<p><img src="Transformer%E6%A8%A1%E5%9E%8B%E8%AF%A6%E8%A7%A3%20-%20Welcome%20to%20AI%20World_files/pic11.png" alt=""></p>

<p>这给我们留下了一个小的挑战，前馈神经网络没法输入8个矩阵呀，这该怎么办呢？所以我们需要一种方式，把8个矩阵降为1个，首先，我们把8个矩阵连在一起，这样会得到一个大的矩阵，再随机初始化一个矩阵和这个组合好的矩阵相乘，最后得到一个最终的矩阵。</p>

<p><img src="Transformer%E6%A8%A1%E5%9E%8B%E8%AF%A6%E8%A7%A3%20-%20Welcome%20to%20AI%20World_files/pic12.png" alt=""></p>

<p>这就是multi-headed attention的全部流程了，这里其实已经有很多矩阵了，我们把所有的矩阵放到一张图内看一下总体的流程。</p>

<p><img src="Transformer%E6%A8%A1%E5%9E%8B%E8%AF%A6%E8%A7%A3%20-%20Welcome%20to%20AI%20World_files/pic13.png" alt=""></p>

<h2 id="positional-encoding"><strong>Positional Encoding</strong></h2>

<p>到目前为止，transformer模型中还缺少一种解释输入序列中单词顺序的方法。为了处理这个问题，transformer给encoder层
和decoder层的输入添加了一个额外的向量Positional 
Encoding，维度和embedding的维度一样，这个向量采用了一种很独特的方法来让模型学习到这个值，这个向量能决定当前词的位置，或者说在一
个句子中不同的词之间的距离。这个位置向量的具体计算方法有很多种，论文中的计算方法如下</p>

<span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-1-Frame" tabindex="0" style="text-align: center; position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mi&gt;P&lt;/mi&gt;&lt;mi&gt;E&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;p&lt;/mi&gt;&lt;mi&gt;o&lt;/mi&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;p&lt;/mi&gt;&lt;mi&gt;o&lt;/mi&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo&gt;/&lt;/mo&gt;&lt;/mrow&gt;&lt;msup&gt;&lt;mn&gt;10000&lt;/mn&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/mrow&gt;&lt;/msup&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo&gt;/&lt;/mo&gt;&lt;/mrow&gt;&lt;msub&gt;&lt;mi&gt;d&lt;/mi&gt;&lt;mi&gt;m&lt;/mi&gt;&lt;/msub&gt;&lt;mi&gt;o&lt;/mi&gt;&lt;mi&gt;d&lt;/mi&gt;&lt;mi&gt;e&lt;/mi&gt;&lt;mi&gt;l&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1" style="width: 21.853em; display: inline-block;"><span style="display: inline-block; position: relative; width: 17.175em; height: 0px; font-size: 127%;"><span style="position: absolute; clip: rect(1.232em, 1017.08em, 2.661em, -1000em); top: -2.264em; left: 0em;"><span class="mrow" id="MathJax-Span-2"><span class="mi" id="MathJax-Span-3" style="font-family: MathJax_Math; font-style: italic;">P<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.109em;"></span></span><span class="mi" id="MathJax-Span-4" style="font-family: MathJax_Math; font-style: italic;">E<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.026em;"></span></span><span class="mo" id="MathJax-Span-5" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-6" style="font-family: MathJax_Math; font-style: italic;">p</span><span class="mi" id="MathJax-Span-7" style="font-family: MathJax_Math; font-style: italic;">o</span><span class="mi" id="MathJax-Span-8" style="font-family: MathJax_Math; font-style: italic;">s</span><span class="mo" id="MathJax-Span-9" style="font-family: MathJax_Main;">,</span><span class="mn" id="MathJax-Span-10" style="font-family: MathJax_Main; padding-left: 0.167em;">2</span><span class="mi" id="MathJax-Span-11" style="font-family: MathJax_Math; font-style: italic;">i</span><span class="mo" id="MathJax-Span-12" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-13" style="font-family: MathJax_Main; padding-left: 0.278em;">=</span><span class="mi" id="MathJax-Span-14" style="font-family: MathJax_Math; font-style: italic; padding-left: 0.278em;">s</span><span class="mi" id="MathJax-Span-15" style="font-family: MathJax_Math; font-style: italic;">i</span><span class="mi" id="MathJax-Span-16" style="font-family: MathJax_Math; font-style: italic;">n</span><span class="mo" id="MathJax-Span-17" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-18" style="font-family: MathJax_Math; font-style: italic;">p</span><span class="mi" id="MathJax-Span-19" style="font-family: MathJax_Math; font-style: italic;">o</span><span class="mi" id="MathJax-Span-20" style="font-family: MathJax_Math; font-style: italic;">s</span><span class="texatom" id="MathJax-Span-21"><span class="mrow" id="MathJax-Span-22"><span class="mo" id="MathJax-Span-23" style="font-family: MathJax_Main;">/</span></span></span><span class="msubsup" id="MathJax-Span-24"><span style="display: inline-block; position: relative; width: 3.173em; height: 0px;"><span style="position: absolute; clip: rect(3.173em, 1002.46em, 4.156em, -1000em); top: -3.986em; left: 0em;"><span class="mn" id="MathJax-Span-25" style="font-family: MathJax_Main;">10000</span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="position: absolute; top: -4.399em; left: 2.5em;"><span class="texatom" id="MathJax-Span-26"><span class="mrow" id="MathJax-Span-27"><span class="mn" id="MathJax-Span-28" style="font-size: 70.7%; font-family: MathJax_Main;">2</span><span class="mi" id="MathJax-Span-29" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">i</span></span></span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span></span></span><span class="texatom" id="MathJax-Span-30"><span class="mrow" id="MathJax-Span-31"><span class="mo" id="MathJax-Span-32" style="font-family: MathJax_Main;">/</span></span></span><span class="msubsup" id="MathJax-Span-33"><span style="display: inline-block; position: relative; width: 1.216em; height: 0px;"><span style="position: absolute; clip: rect(3.145em, 1000.52em, 4.144em, -1000em); top: -3.986em; left: 0em;"><span class="mi" id="MathJax-Span-34" style="font-family: MathJax_Math; font-style: italic;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="position: absolute; top: -3.836em; left: 0.52em;"><span class="mi" id="MathJax-Span-35" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">m</span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span></span></span><span class="mi" id="MathJax-Span-36" style="font-family: MathJax_Math; font-style: italic;">o</span><span class="mi" id="MathJax-Span-37" style="font-family: MathJax_Math; font-style: italic;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mi" id="MathJax-Span-38" style="font-family: MathJax_Math; font-style: italic;">e</span><span class="mi" id="MathJax-Span-39" style="font-family: MathJax_Math; font-style: italic;">l</span><span class="mo" id="MathJax-Span-40" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.264em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.38em; border-left: 0px solid; width: 0px; height: 1.565em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>P</mi><mi>E</mi><mo stretchy="false">(</mo><mi>p</mi><mi>o</mi><mi>s</mi><mo>,</mo><mn>2</mn><mi>i</mi><mo stretchy="false">)</mo><mo>=</mo><mi>s</mi><mi>i</mi><mi>n</mi><mo stretchy="false">(</mo><mi>p</mi><mi>o</mi><mi>s</mi><mrow class="MJX-TeXAtom-ORD"><mo>/</mo></mrow><msup><mn>10000</mn><mrow class="MJX-TeXAtom-ORD"><mn>2</mn><mi>i</mi></mrow></msup><mrow class="MJX-TeXAtom-ORD"><mo>/</mo></mrow><msub><mi>d</mi><mi>m</mi></msub><mi>o</mi><mi>d</mi><mi>e</mi><mi>l</mi><mo stretchy="false">)</mo></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-1">PE(pos,2i) = sin(pos/10000^{2i}/d_model)</script>

<span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-2-Frame" tabindex="0" style="text-align: center; position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mi&gt;P&lt;/mi&gt;&lt;mi&gt;E&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;p&lt;/mi&gt;&lt;mi&gt;o&lt;/mi&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mi&gt;c&lt;/mi&gt;&lt;mi&gt;o&lt;/mi&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;p&lt;/mi&gt;&lt;mi&gt;o&lt;/mi&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo&gt;/&lt;/mo&gt;&lt;/mrow&gt;&lt;msup&gt;&lt;mn&gt;10000&lt;/mn&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/mrow&gt;&lt;/msup&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo&gt;/&lt;/mo&gt;&lt;/mrow&gt;&lt;msub&gt;&lt;mi&gt;d&lt;/mi&gt;&lt;mi&gt;m&lt;/mi&gt;&lt;/msub&gt;&lt;mi&gt;o&lt;/mi&gt;&lt;mi&gt;d&lt;/mi&gt;&lt;mi&gt;e&lt;/mi&gt;&lt;mi&gt;l&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-41" style="width: 24.018em; display: inline-block;"><span style="display: inline-block; position: relative; width: 18.898em; height: 0px; font-size: 127%;"><span style="position: absolute; clip: rect(1.232em, 1018.8em, 2.661em, -1000em); top: -2.264em; left: 0em;"><span class="mrow" id="MathJax-Span-42"><span class="mi" id="MathJax-Span-43" style="font-family: MathJax_Math; font-style: italic;">P<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.109em;"></span></span><span class="mi" id="MathJax-Span-44" style="font-family: MathJax_Math; font-style: italic;">E<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.026em;"></span></span><span class="mo" id="MathJax-Span-45" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-46" style="font-family: MathJax_Math; font-style: italic;">p</span><span class="mi" id="MathJax-Span-47" style="font-family: MathJax_Math; font-style: italic;">o</span><span class="mi" id="MathJax-Span-48" style="font-family: MathJax_Math; font-style: italic;">s</span><span class="mo" id="MathJax-Span-49" style="font-family: MathJax_Main;">,</span><span class="mn" id="MathJax-Span-50" style="font-family: MathJax_Main; padding-left: 0.167em;">2</span><span class="mi" id="MathJax-Span-51" style="font-family: MathJax_Math; font-style: italic;">i</span><span class="mo" id="MathJax-Span-52" style="font-family: MathJax_Main; padding-left: 0.222em;">+</span><span class="mn" id="MathJax-Span-53" style="font-family: MathJax_Main; padding-left: 0.222em;">1</span><span class="mo" id="MathJax-Span-54" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-55" style="font-family: MathJax_Main; padding-left: 0.278em;">=</span><span class="mi" id="MathJax-Span-56" style="font-family: MathJax_Math; font-style: italic; padding-left: 0.278em;">c</span><span class="mi" id="MathJax-Span-57" style="font-family: MathJax_Math; font-style: italic;">o</span><span class="mi" id="MathJax-Span-58" style="font-family: MathJax_Math; font-style: italic;">s</span><span class="mo" id="MathJax-Span-59" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-60" style="font-family: MathJax_Math; font-style: italic;">p</span><span class="mi" id="MathJax-Span-61" style="font-family: MathJax_Math; font-style: italic;">o</span><span class="mi" id="MathJax-Span-62" style="font-family: MathJax_Math; font-style: italic;">s</span><span class="texatom" id="MathJax-Span-63"><span class="mrow" id="MathJax-Span-64"><span class="mo" id="MathJax-Span-65" style="font-family: MathJax_Main;">/</span></span></span><span class="msubsup" id="MathJax-Span-66"><span style="display: inline-block; position: relative; width: 3.173em; height: 0px;"><span style="position: absolute; clip: rect(3.173em, 1002.46em, 4.156em, -1000em); top: -3.986em; left: 0em;"><span class="mn" id="MathJax-Span-67" style="font-family: MathJax_Main;">10000</span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="position: absolute; top: -4.399em; left: 2.5em;"><span class="texatom" id="MathJax-Span-68"><span class="mrow" id="MathJax-Span-69"><span class="mn" id="MathJax-Span-70" style="font-size: 70.7%; font-family: MathJax_Main;">2</span><span class="mi" id="MathJax-Span-71" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">i</span></span></span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span></span></span><span class="texatom" id="MathJax-Span-72"><span class="mrow" id="MathJax-Span-73"><span class="mo" id="MathJax-Span-74" style="font-family: MathJax_Main;">/</span></span></span><span class="msubsup" id="MathJax-Span-75"><span style="display: inline-block; position: relative; width: 1.216em; height: 0px;"><span style="position: absolute; clip: rect(3.145em, 1000.52em, 4.144em, -1000em); top: -3.986em; left: 0em;"><span class="mi" id="MathJax-Span-76" style="font-family: MathJax_Math; font-style: italic;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="position: absolute; top: -3.836em; left: 0.52em;"><span class="mi" id="MathJax-Span-77" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">m</span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span></span></span><span class="mi" id="MathJax-Span-78" style="font-family: MathJax_Math; font-style: italic;">o</span><span class="mi" id="MathJax-Span-79" style="font-family: MathJax_Math; font-style: italic;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mi" id="MathJax-Span-80" style="font-family: MathJax_Math; font-style: italic;">e</span><span class="mi" id="MathJax-Span-81" style="font-family: MathJax_Math; font-style: italic;">l</span><span class="mo" id="MathJax-Span-82" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.264em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.38em; border-left: 0px solid; width: 0px; height: 1.565em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>P</mi><mi>E</mi><mo stretchy="false">(</mo><mi>p</mi><mi>o</mi><mi>s</mi><mo>,</mo><mn>2</mn><mi>i</mi><mo>+</mo><mn>1</mn><mo stretchy="false">)</mo><mo>=</mo><mi>c</mi><mi>o</mi><mi>s</mi><mo stretchy="false">(</mo><mi>p</mi><mi>o</mi><mi>s</mi><mrow class="MJX-TeXAtom-ORD"><mo>/</mo></mrow><msup><mn>10000</mn><mrow class="MJX-TeXAtom-ORD"><mn>2</mn><mi>i</mi></mrow></msup><mrow class="MJX-TeXAtom-ORD"><mo>/</mo></mrow><msub><mi>d</mi><mi>m</mi></msub><mi>o</mi><mi>d</mi><mi>e</mi><mi>l</mi><mo stretchy="false">)</mo></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-2">PE(pos,2i+1) = cos(pos/10000^{2i}/d_model)</script>

<p>其中pos是指当前词在句子中的位置，i是指向量中每个值的index，可以看出，在<strong>偶数位置，使用正弦编码，在奇数位置，使用余弦编码</strong>，这里提供一下代码。</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>position_encoding = np.array(
    [[pos / np.power(10000, 2.0 * (j // 2) / d_model) for j in range(d_model)] for pos in range(max_seq_len)])

position_encoding[:, 0::2] = np.sin(position_encoding[:, 0::2])
position_encoding[:, 1::2] = np.cos(position_encoding[:, 1::2])
</code></pre></div></div>

<p>最后把这个Positional Encoding与embedding的值相加，作为输入送到下一层。</p>

<p><img src="Transformer%E6%A8%A1%E5%9E%8B%E8%AF%A6%E8%A7%A3%20-%20Welcome%20to%20AI%20World_files/pic16.png" alt=""></p>

<h2 id="layer-normalization"><strong>Layer normalization</strong></h2>

<p>在transformer中，每一个子层（self-attetion，ffnn）之后都会接一个残缺模块，并且有一个Layer normalization</p>

<p><img src="Transformer%E6%A8%A1%E5%9E%8B%E8%AF%A6%E8%A7%A3%20-%20Welcome%20to%20AI%20World_files/pic19.png" alt=""></p>

<p>残缺模块相信大家都很清楚了，这里不再讲解，主要讲解下Layer 
normalization。Normalization有很多种，但是它们都有一个共同的目的，那就是把输入转化成均值为0方差为1的数据。我们在把数
据送入激活函数之前进行normalization（归一化），因为我们不希望输入数据落在激活函数的饱和区。</p>

<p>说到 normalization，那就肯定得提到 <a href="https://terrifyzhao.github.io/2018/02/08/Batch-Normalization%E6%B5%85%E6%9E%90.html">Batch Normalization</a>。
BN的主要思想就是：在每一层的每一批数据上进行归一化。我们可能会对输入数据进行归一化，但是经过该网络层的作用后，我们的数据已经不再是归一化的了。
随着这种情况的发展，数据的偏差越来越大，我的反向传播需要考虑到这些大的偏差，这就迫使我们只能使用较小的学习率来防止梯度消失或者梯度爆炸。</p>

<p>BN的具体做法就是对每一小批数据，在批这个方向上做归一化。如下图所示：</p>

<p><img src="Transformer%E6%A8%A1%E5%9E%8B%E8%AF%A6%E8%A7%A3%20-%20Welcome%20to%20AI%20World_files/pic17.jpg" alt=""></p>

<p>可以看到，右半边求均值是沿着数据 batch_size的方向进行的，其计算公式如下：</p>

<span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-3-Frame" tabindex="0" style="text-align: center; position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mi&gt;B&lt;/mi&gt;&lt;mi&gt;N&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mi&gt;&amp;#x03B1;&lt;/mi&gt;&lt;mo&gt;&amp;#xD7;&lt;/mo&gt;&lt;mfrac&gt;&lt;mrow&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;&amp;#x03BC;&lt;/mi&gt;&lt;mi&gt;b&lt;/mi&gt;&lt;/msub&gt;&lt;/mrow&gt;&lt;msqrt&gt;&lt;msubsup&gt;&lt;mi&gt;&amp;#x03C3;&lt;/mi&gt;&lt;mi&gt;B&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msubsup&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mi&gt;&amp;#x03F5;&lt;/mi&gt;&lt;/msqrt&gt;&lt;/mfrac&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mi&gt;&amp;#x03B2;&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-83" style="width: 15.898em; display: inline-block;"><span style="display: inline-block; position: relative; width: 12.5em; height: 0px; font-size: 127%;"><span style="position: absolute; clip: rect(0.854em, 1012.5em, 4.174em, -1000em); top: -2.264em; left: 0em;"><span class="mrow" id="MathJax-Span-84"><span class="mi" id="MathJax-Span-85" style="font-family: MathJax_Math; font-style: italic;">B</span><span class="mi" id="MathJax-Span-86" style="font-family: MathJax_Math; font-style: italic;">N<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.085em;"></span></span><span class="mo" id="MathJax-Span-87" style="font-family: MathJax_Main;">(</span><span class="msubsup" id="MathJax-Span-88"><span style="display: inline-block; position: relative; width: 0.891em; height: 0px;"><span style="position: absolute; clip: rect(3.397em, 1000.52em, 4.145em, -1000em); top: -3.986em; left: 0em;"><span class="mi" id="MathJax-Span-89" style="font-family: MathJax_Math; font-style: italic;">x</span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="position: absolute; top: -3.836em; left: 0.572em;"><span class="mi" id="MathJax-Span-90" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">i</span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span></span></span><span class="mo" id="MathJax-Span-91" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-92" style="font-family: MathJax_Main; padding-left: 0.278em;">=</span><span class="mi" id="MathJax-Span-93" style="font-family: MathJax_Math; font-style: italic; padding-left: 0.278em;">α</span><span class="mo" id="MathJax-Span-94" style="font-family: MathJax_Main; padding-left: 0.222em;">×</span><span class="mfrac" id="MathJax-Span-95" style="padding-left: 0.222em;"><span style="display: inline-block; position: relative; width: 3.956em; height: 0px; margin-right: 0.12em; margin-left: 0.12em;"><span style="position: absolute; clip: rect(3.256em, 1003.09em, 4.35em, -1000em); top: -4.665em; left: 50%; margin-left: -1.547em;"><span class="mrow" id="MathJax-Span-96"><span class="msubsup" id="MathJax-Span-97"><span style="display: inline-block; position: relative; width: 0.891em; height: 0px;"><span style="position: absolute; clip: rect(3.397em, 1000.52em, 4.145em, -1000em); top: -3.986em; left: 0em;"><span class="mi" id="MathJax-Span-98" style="font-family: MathJax_Math; font-style: italic;">x</span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="position: absolute; top: -3.836em; left: 0.572em;"><span class="mi" id="MathJax-Span-99" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">i</span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span></span></span><span class="mo" id="MathJax-Span-100" style="font-family: MathJax_Main; padding-left: 0.222em;">−</span><span class="msubsup" id="MathJax-Span-101" style="padding-left: 0.222em;"><span style="display: inline-block; position: relative; width: 0.981em; height: 0px;"><span style="position: absolute; clip: rect(3.397em, 1000.58em, 4.35em, -1000em); top: -3.986em; left: 0em;"><span class="mi" id="MathJax-Span-102" style="font-family: MathJax_Math; font-style: italic;">μ</span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="position: absolute; top: -3.836em; left: 0.603em;"><span class="mi" id="MathJax-Span-103" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">b</span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="position: absolute; clip: rect(2.676em, 1003.84em, 4.772em, -1000em); top: -2.861em; left: 50%; margin-left: -1.918em;"><span class="msqrt" id="MathJax-Span-104"><span style="display: inline-block; position: relative; width: 3.836em; height: 0px;"><span style="position: absolute; clip: rect(3.023em, 1002.79em, 4.452em, -1000em); top: -3.986em; left: 1em;"><span class="mrow" id="MathJax-Span-105"><span class="msubsup" id="MathJax-Span-106"><span style="display: inline-block; position: relative; width: 1.183em; height: 0px;"><span style="position: absolute; clip: rect(3.408em, 1000.57em, 4.145em, -1000em); top: -3.986em; left: 0em;"><span class="mi" id="MathJax-Span-107" style="font-family: MathJax_Math; font-style: italic;">σ<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.001em;"></span></span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="position: absolute; clip: rect(3.368em, 1000.43em, 4.134em, -1000em); top: -4.331em; left: 0.622em;"><span class="mn" id="MathJax-Span-108" style="font-size: 70.7%; font-family: MathJax_Main;">2</span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="position: absolute; clip: rect(3.356em, 1000.61em, 4.134em, -1000em); top: -3.668em; left: 0.571em;"><span class="mi" id="MathJax-Span-109" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">B</span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span></span></span><span class="mo" id="MathJax-Span-110" style="font-family: MathJax_Main; padding-left: 0.222em;">+</span><span class="mi" id="MathJax-Span-111" style="font-family: MathJax_Math; font-style: italic; padding-left: 0.222em;">ϵ</span></span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="position: absolute; clip: rect(3.566em, 1002.84em, 3.906em, -1000em); top: -4.876em; left: 1em;"><span style="display: inline-block; position: relative; width: 2.836em; height: 0px;"><span style="position: absolute; font-family: MathJax_Main; top: -3.986em; left: -0.084em;">−<span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="position: absolute; font-family: MathJax_Main; top: -3.986em; left: 2.142em;">−<span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="font-family: MathJax_Main; position: absolute; top: -3.986em; left: 0.454em;">−<span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="font-family: MathJax_Main; position: absolute; top: -3.986em; left: 1.016em;">−<span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="font-family: MathJax_Main; position: absolute; top: -3.986em; left: 1.579em;">−<span style="display: inline-block; width: 0px; height: 3.986em;"></span></span></span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="position: absolute; clip: rect(2.689em, 1001.02em, 4.784em, -1000em); top: -3.999em; left: 0em;"><span style="font-family: MathJax_Size2;">√</span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="position: absolute; clip: rect(0.874em, 1003.96em, 1.23em, -1000em); top: -1.303em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 3.956em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.083em;"></span></span></span></span><span class="mo" id="MathJax-Span-112" style="font-family: MathJax_Main; padding-left: 0.222em;">+</span><span class="mi" id="MathJax-Span-113" style="font-family: MathJax_Math; font-style: italic; padding-left: 0.222em;">β<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.007em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.264em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -2.302em; border-left: 0px solid; width: 0px; height: 3.967em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>B</mi><mi>N</mi><mo stretchy="false">(</mo><msub><mi>x</mi><mi>i</mi></msub><mo stretchy="false">)</mo><mo>=</mo><mi>α</mi><mo>×</mo><mfrac><mrow><msub><mi>x</mi><mi>i</mi></msub><mo>−</mo><msub><mi>μ</mi><mi>b</mi></msub></mrow><msqrt><msubsup><mi>σ</mi><mi>B</mi><mn>2</mn></msubsup><mo>+</mo><mi>ϵ</mi></msqrt></mfrac><mo>+</mo><mi>β</mi></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-3">BN(x_i)=\alpha × \frac{x_i-\mu_b}{\sqrt{\sigma^2_B+\epsilon}}+\beta</script>

<p>那么什么是 Layer normalization 呢？它也是归一化数据的一种方式，不过 LN 是在每一个样本上计算均值和方差，而不是BN那种在批方向计算均值和方差！</p>

<p><img src="Transformer%E6%A8%A1%E5%9E%8B%E8%AF%A6%E8%A7%A3%20-%20Welcome%20to%20AI%20World_files/pic18.jpg" alt=""></p>

<p>下面看一下 LN 的公式：</p>

<span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-4-Frame" tabindex="0" style="text-align: center; position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mi&gt;L&lt;/mi&gt;&lt;mi&gt;N&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mi&gt;&amp;#x03B1;&lt;/mi&gt;&lt;mo&gt;&amp;#xD7;&lt;/mo&gt;&lt;mfrac&gt;&lt;mrow&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;&amp;#x03BC;&lt;/mi&gt;&lt;mi&gt;L&lt;/mi&gt;&lt;/msub&gt;&lt;/mrow&gt;&lt;msqrt&gt;&lt;msubsup&gt;&lt;mi&gt;&amp;#x03C3;&lt;/mi&gt;&lt;mi&gt;L&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msubsup&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mi&gt;&amp;#x03F5;&lt;/mi&gt;&lt;/msqrt&gt;&lt;/mfrac&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mi&gt;&amp;#x03B2;&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-114" style="width: 15.701em; display: inline-block;"><span style="display: inline-block; position: relative; width: 12.352em; height: 0px; font-size: 127%;"><span style="position: absolute; clip: rect(0.854em, 1012.35em, 4.174em, -1000em); top: -2.264em; left: 0em;"><span class="mrow" id="MathJax-Span-115"><span class="mi" id="MathJax-Span-116" style="font-family: MathJax_Math; font-style: italic;">L</span><span class="mi" id="MathJax-Span-117" style="font-family: MathJax_Math; font-style: italic;">N<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.085em;"></span></span><span class="mo" id="MathJax-Span-118" style="font-family: MathJax_Main;">(</span><span class="msubsup" id="MathJax-Span-119"><span style="display: inline-block; position: relative; width: 0.891em; height: 0px;"><span style="position: absolute; clip: rect(3.397em, 1000.52em, 4.145em, -1000em); top: -3.986em; left: 0em;"><span class="mi" id="MathJax-Span-120" style="font-family: MathJax_Math; font-style: italic;">x</span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="position: absolute; top: -3.836em; left: 0.572em;"><span class="mi" id="MathJax-Span-121" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">i</span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span></span></span><span class="mo" id="MathJax-Span-122" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-123" style="font-family: MathJax_Main; padding-left: 0.278em;">=</span><span class="mi" id="MathJax-Span-124" style="font-family: MathJax_Math; font-style: italic; padding-left: 0.278em;">α</span><span class="mo" id="MathJax-Span-125" style="font-family: MathJax_Main; padding-left: 0.222em;">×</span><span class="mfrac" id="MathJax-Span-126" style="padding-left: 0.222em;"><span style="display: inline-block; position: relative; width: 3.901em; height: 0px; margin-right: 0.12em; margin-left: 0.12em;"><span style="position: absolute; clip: rect(3.256em, 1003.27em, 4.35em, -1000em); top: -4.665em; left: 50%; margin-left: -1.636em;"><span class="mrow" id="MathJax-Span-127"><span class="msubsup" id="MathJax-Span-128"><span style="display: inline-block; position: relative; width: 0.891em; height: 0px;"><span style="position: absolute; clip: rect(3.397em, 1000.52em, 4.145em, -1000em); top: -3.986em; left: 0em;"><span class="mi" id="MathJax-Span-129" style="font-family: MathJax_Math; font-style: italic;">x</span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="position: absolute; top: -3.836em; left: 0.572em;"><span class="mi" id="MathJax-Span-130" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">i</span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span></span></span><span class="mo" id="MathJax-Span-131" style="font-family: MathJax_Main; padding-left: 0.222em;">−</span><span class="msubsup" id="MathJax-Span-132" style="padding-left: 0.222em;"><span style="display: inline-block; position: relative; width: 1.16em; height: 0px;"><span style="position: absolute; clip: rect(3.397em, 1000.58em, 4.35em, -1000em); top: -3.986em; left: 0em;"><span class="mi" id="MathJax-Span-133" style="font-family: MathJax_Math; font-style: italic;">μ</span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="position: absolute; top: -3.836em; left: 0.603em;"><span class="mi" id="MathJax-Span-134" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">L</span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="position: absolute; clip: rect(2.676em, 1003.78em, 4.772em, -1000em); top: -2.861em; left: 50%; margin-left: -1.89em;"><span class="msqrt" id="MathJax-Span-135"><span style="display: inline-block; position: relative; width: 3.781em; height: 0px;"><span style="position: absolute; clip: rect(3.023em, 1002.73em, 4.452em, -1000em); top: -3.986em; left: 1em;"><span class="mrow" id="MathJax-Span-136"><span class="msubsup" id="MathJax-Span-137"><span style="display: inline-block; position: relative; width: 1.128em; height: 0px;"><span style="position: absolute; clip: rect(3.408em, 1000.57em, 4.145em, -1000em); top: -3.986em; left: 0em;"><span class="mi" id="MathJax-Span-138" style="font-family: MathJax_Math; font-style: italic;">σ<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.001em;"></span></span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="position: absolute; clip: rect(3.368em, 1000.43em, 4.134em, -1000em); top: -4.331em; left: 0.622em;"><span class="mn" id="MathJax-Span-139" style="font-size: 70.7%; font-family: MathJax_Main;">2</span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="position: absolute; clip: rect(3.356em, 1000.56em, 4.134em, -1000em); top: -3.668em; left: 0.571em;"><span class="mi" id="MathJax-Span-140" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">L</span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span></span></span><span class="mo" id="MathJax-Span-141" style="font-family: MathJax_Main; padding-left: 0.222em;">+</span><span class="mi" id="MathJax-Span-142" style="font-family: MathJax_Math; font-style: italic; padding-left: 0.222em;">ϵ</span></span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="position: absolute; clip: rect(3.566em, 1002.78em, 3.906em, -1000em); top: -4.876em; left: 1em;"><span style="display: inline-block; position: relative; width: 2.781em; height: 0px;"><span style="position: absolute; font-family: MathJax_Main; top: -3.986em; left: -0.084em;">−<span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="position: absolute; font-family: MathJax_Main; top: -3.986em; left: 2.087em;">−<span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="font-family: MathJax_Main; position: absolute; top: -3.986em; left: 0.44em;">−<span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="font-family: MathJax_Main; position: absolute; top: -3.986em; left: 0.989em;">−<span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="font-family: MathJax_Main; position: absolute; top: -3.986em; left: 1.538em;">−<span style="display: inline-block; width: 0px; height: 3.986em;"></span></span></span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="position: absolute; clip: rect(2.689em, 1001.02em, 4.784em, -1000em); top: -3.999em; left: 0em;"><span style="font-family: MathJax_Size2;">√</span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="position: absolute; clip: rect(0.874em, 1003.9em, 1.23em, -1000em); top: -1.303em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 3.901em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.083em;"></span></span></span></span><span class="mo" id="MathJax-Span-143" style="font-family: MathJax_Main; padding-left: 0.222em;">+</span><span class="mi" id="MathJax-Span-144" style="font-family: MathJax_Math; font-style: italic; padding-left: 0.222em;">β<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.007em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.264em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -2.302em; border-left: 0px solid; width: 0px; height: 3.967em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>L</mi><mi>N</mi><mo stretchy="false">(</mo><msub><mi>x</mi><mi>i</mi></msub><mo stretchy="false">)</mo><mo>=</mo><mi>α</mi><mo>×</mo><mfrac><mrow><msub><mi>x</mi><mi>i</mi></msub><mo>−</mo><msub><mi>μ</mi><mi>L</mi></msub></mrow><msqrt><msubsup><mi>σ</mi><mi>L</mi><mn>2</mn></msubsup><mo>+</mo><mi>ϵ</mi></msqrt></mfrac><mo>+</mo><mi>β</mi></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-4">LN(x_i)=\alpha × \frac{x_i-\mu_L}{\sqrt{\sigma^2_L+\epsilon}}+\beta</script>

<p>到这里为止就是全部encoders的内容了，如果把两个encoders叠加在一起就是这样的结构</p>

<p><img src="Transformer%E6%A8%A1%E5%9E%8B%E8%AF%A6%E8%A7%A3%20-%20Welcome%20to%20AI%20World_files/pic20.png" alt=""></p>

<h2 id="decoder层"><strong>Decoder层</strong></h2>

<p><img src="Transformer%E6%A8%A1%E5%9E%8B%E8%AF%A6%E8%A7%A3%20-%20Welcome%20to%20AI%20World_files/pic24.jpg" alt=""></p>

<p>上图是transformer的一个详细结构，相比本文一开始结束的结构图会更详细些，接下来，我们会按照这个结构图讲解下decoder部分。</p>

<p>可以看到decoder部分其实和encoder部分大同小异，不过在最下面额外多了一个masked mutil-head attetion，这里的mask也是transformer一个很关键的技术，我们一起来看一下。</p>

<h2 id="mask"><strong>Mask</strong></h2>

<p>mask 表示掩码，它对某些值进行掩盖，使其在参数更新时不产生效果。Transformer 模型里面涉及两种 mask，分别是 padding mask 和 sequence mask。</p>

<p>其中，padding mask 在所有的 scaled dot-product attention 里面都需要用到，而 sequence mask 只有在 decoder 的 self-attention 里面用到。</p>

<p><strong>Padding Mask</strong></p>

<p>什么是 padding mask 
呢？因为每个批次输入序列长度是不一样的也就是说，我们要对输入序列进行对齐。具体来说，就是给在较短的序列后面填充 
0。但是如果输入的序列太长，则是截取左边的内容，把多余的直接舍弃。因为这些填充的位置，其实是没什么意义的，所以我们的attention机制不应该
把注意力放在这些位置上，所以我们需要进行一些处理。</p>

<p>具体的做法是，把这些位置的值加上一个非常大的负数(负无穷)，这样的话，经过 softmax，这些位置的概率就会接近0！</p>

<p>而我们的 padding mask 实际上是一个张量，每个值都是一个Boolean，值为 false 的地方就是我们要进行处理的地方。</p>

<p><strong>Sequence mask</strong></p>

<p>文章前面也提到，sequence mask 是为了使得 decoder 不能看见未来的信息。也就是对于一个序列，在 time_step 为
 t 的时刻，我们的解码输出应该只能依赖于 t 时刻之前的输出，而不能依赖 t 之后的输出。因此我们需要想一个办法，把 t 
之后的信息给隐藏起来。</p>

<p>那么具体怎么做呢？也很简单：产生一个上三角矩阵，上三角的值全为0。把这个矩阵作用在每一个序列上，就可以达到我们的目的。</p>

<ul>
  <li>对于 decoder 的 self-attention，里面使用到的 scaled dot-product 
attention，同时需要padding mask 和 sequence mask 作为 
attn_mask，具体实现就是两个mask相加作为attn_mask。</li>
  <li>其他情况，attn_mask 一律等于 padding mask。</li>
</ul>

<h2 id="输出层"><strong>输出层</strong></h2>

<p>当decoder层全部执行完毕后，怎么把得到的向量映射为我们需要的词呢，很简单，只需要在结尾再添加一个全连接层和softmax层，假如我们的词典是1w个词，那最终softmax会输入1w个词的概率，概率值最大的对应的词就是我们最终的结果。</p>

<p><img src="Transformer%E6%A8%A1%E5%9E%8B%E8%AF%A6%E8%A7%A3%20-%20Welcome%20to%20AI%20World_files/pic23.png" alt=""></p>

<p>这就是本文的全部内容了，希望对你有所帮助，如果想了解更多的详情，请参阅论文 <a href="https://arxiv.org/abs/1706.03762">Attention Is All You Need</a>，下一篇博客，将会基于transformer的源码进行代码讲解，帮助大家进一步的了解transformer</p>

    </article>

    
      <!--
Author: Ray-Eldath
refer to:
 - https://github.com/theme-next/hexo-theme-next/blob/4bfbd67b3edc6f11b00357da6e509e5281a896f1/layout/_macro/reward.swig and
 - https://github.com/theme-next/hexo-theme-next/blob/e12bb0b27e16072eb82baa4c7dda1c41c8de7264/source/css/_common/components/post/post-reward.styl
-->
<style media="screen">
  .reward {
    padding: 5px 0;
    margin: 20px auto;
    width: 90%;
    text-align: center;
  }

  .rewardButton {
    background-color: #f44236;
    -moz-border-radius: 8px;
    -webkit-border-radius: 8px;
    border-radius: 8px;
    display: inline-block;
    cursor: pointer;
    color: #ffffff;
    font-family: '微软雅黑';
    font-size: 18px;
    padding: 5px 25px;
    text-decoration: none;
  }

  .rewardButton:hover {
    background-color: #F7877F;
  }

  .wechat:hover p {
    animation: roll 0.1s infinite linear;
    -webkit-animation: roll 0.1s infinite linear;
    -moz-animation: roll 0.1s infinite linear;
  }

  .alipay:hover p {
    animation: roll 0.1s infinite linear;
    -webkit-animation: roll 0.1s infinite linear;
    -moz-animation: roll 0.1s infinite linear;
  }

  .QR {
    padding-top: 20px;
  }

  .QR a {
    border: 0;
  }

  .QR img {
    width: 180px;
    max-width: 100%;
    display: inline-block;
    margin: 0.8em 2em 0 2em;
  }
</style>

<div class="reward">
  <a class="rewardButton" title="请Joe喝杯咖啡？">赞 赏</a>

  <div class="QR" style="display: none;">
    
    <div>
      <span style="font-family: '微软雅黑'; font-size: 18px; ">真诚赞赏 手留余香</span>
    </div>
    

    
    <div class="wechat" style="display: inline-block">
      <img class="wechat_qr" src="Transformer%E6%A8%A1%E5%9E%8B%E8%AF%A6%E8%A7%A3%20-%20Welcome%20to%20AI%20World_files/wechat.jpeg" title="用微信请Joe喝杯咖啡？" alt="用微信请Joe喝杯咖啡？">
      <p>微信支付</p>
    </div>
    

    
  </div>
</div>

<script type="text/javascript">
  $(document).ready(function() {
    $("a.rewardButton").click(function() {
      $("div.QR").slideToggle()
    });
  });
</script>

    

    
    <div class="social-share-wrapper">
      <div class="social-share share-component"><a class="social-share-icon icon-wechat" href="javascript:"><div class="wechat-qrcode"><h4>分享到微信朋友圈</h4><div class="qrcode" title="https://terrifyzhao.github.io/2019/01/11/Transformer%E6%A8%A1%E5%9E%8B%E8%AF%A6%E8%A7%A3.html"><canvas width="100" height="100" style="display: none;"></canvas><img alt="Scan me!" style="display: block;" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAYAAABw4pVUAAAFUElEQVR4nO2U224jQQhE/f8/7X3a1cgB6hS0k3GWlkbKeKCoC53H4/F4us/f8/q38x5hRN+iuaS24qwwu35MMC5PLTQa4n5TBA+KkXxIHV2Eqo4sUYK1gdw2EFfkKcO65jpCM85VLenJ+qhXwfcNRM35mEAcssQIGoTCIyeapTgTfyr8DaQ4vzIQEgR9J6drUqWxmkPnTjCC7xsI5f7tgVBDiEmk1533DjMJZxr2RO8GcudA3OcKoowg75Peu/NoPBvIrQJ5Dk4UkqolhLOaDKuaQ3l0uEbY07OBfGIgigiprUR2scijejo6iZbu+yP6SA1R5KhBjmBqhBtI90YojOykPKrmDeQHAiFiFNFqcEX+NVQ3TCK0EzrVQHxp+LSBvPZRDcQX2ydCsiKmepSprlkZlhTaMMv9nXCVPKtBG8gPBDK5ghVJGkxnXkesMtcJqsJ2uQb1G8jHBEKIDAZL8irkigfpUbOznoon1VTUbSDZ7KznrYGQJgVGzKyOMtHYrtFiKM4THzC/DsgG8uZA1OBKlGumY6JrrjO/0q1+Hxm+gXxYIB1jokC6pIlw+l4datCpQLo+bCB3DIQSqMRNzFOGTOujnsq4rJfMd2pDfhGII4oKdjBPLISaR7hQrtfv9KT+dcRsIG8MpDKEmEtNBEQk+ZNGODzcJXN6Ah4biOLx44HQZvKtEk7Mcf51OLURP7pc7tJWGAHmBnLbQDqGOGZRLNeQaq7iR3hQTZNl20DuGsgXxoEB1e9dM8lcaq4yw51f1dD6zvzn87mBRHi3CcS9XuQog8hcEkw2l/Ig+ggvZ4nCd0eEIhydDYTxurzXQ1xzFAGndsrtNNY7sAOMDeRWgVSmKTMrYGqyO0ctQ2d+NoNikwXFGqviDYRhHw2EXD2HEDXghBHX9w7H11lqjjqTRfj3ngE7qROjHRH0cbgTs+mc6vdKJwrMEVXVTTCynv8+EPe6V+Tpd2LihAcxsYt1ku8GcudATplNjIjqSGjT0zEvwyD1SssG8imBVARUs2MAOVRExc/lcf3uLmA1v7PMG8jzhoEQoR0RGUb0rkSMRRpY0XE1VrqlHxkg/X0DeWMgxDx1ValJHYwKW5mk3h0fsuN4mM5yiGwg9TkSiDJOiaakJxjUkKjWMcQNgmJXHgaYG8htA1GDu6FVpCvh4HqnvDs9dC7pHXzfQNy5pHfw3b9eJ0K81qleIsqpVTNomM6iUk3hDVGEou2mm0gCoQZUPZ3b5ehWfAYLsoF0dCs+7UAq4dlxDOn0qF7Fz+Hh1lQ8nd70e0fwBvJNgVSDCDGCQcxTpKt+F7PDI5vvaMx6N5AGj2y+ozHrfVRNapB1FYehheQHXDvzFA/KsfStIr2B/EAgnavpXGv6bpI+/kS4VEPnFJo2kFsF4pgUgbomEXIZpqqvelWP0kkWg2iR86PiDcTjcTQQMoiI6wShBKt6gjEJonPcBQj6NpBbBeKARKDZAEUwuuauiIiH6qmWjx6yeO5i/KuLBjjE1MANpOb+BZuIyIgocp3Aql7nSQUbvQqzw1P6kTIHxxFeiaA9xHRq4mTLq3rlh9SaIoCzgbwhEEKwEkmvIjVsasRES9fEigd9v/y+gSiulPuxQOghRlHyHXwlhnIkAXeWarKIl28byG0DmRAdXNEOadvk7FzrXA0dPgBjA/lVgSjhylwylxhEQ1TfnUV0FoFibyC/PRAV0EQUmdE1iMzN5p/gc6nfQG4biEuEDHbFOnMd4505dCGyYJwn6N1AMjy37lggXRBCVl1vIiibQYxQvRGPDNf5nc4N6jaQVx4ZrvM7nft6/gAO0rF4zHzLDAAAAABJRU5ErkJggg=="></div><div class="help"><p>扫码后点击右上角</p><p>将本文分享至朋友圈</p></div></div></a><a class="social-share-icon icon-weibo" href="http://service.weibo.com/share/share.php?url=https%3A%2F%2Fterrifyzhao.github.io%2F2019%2F01%2F11%2FTransformer%25E6%25A8%25A1%25E5%259E%258B%25E8%25AF%25A6%25E8%25A7%25A3.html&amp;title=Transformer%E6%A8%A1%E5%9E%8B%E8%AF%A6%E8%A7%A3%20-%20Welcome%20to%20AI%20World&amp;pic=https%3A%2F%2Fraw.githubusercontent.com%2Fterrifyzhao%2Fterrifyzhao.github.io%2Fmaster%2Fassets%2Fimg%2F2019-01-06-Transformer%25E6%25A8%25A1%25E5%259E%258B%25E8%25AF%25A6%25E8%25A7%25A3%2Fpic1.png&amp;appkey=" target="_blank"></a><a class="social-share-icon icon-douban" href="http://shuo.douban.com/!service/share?href=https%3A%2F%2Fterrifyzhao.github.io%2F2019%2F01%2F11%2FTransformer%25E6%25A8%25A1%25E5%259E%258B%25E8%25AF%25A6%25E8%25A7%25A3.html&amp;name=Transformer%E6%A8%A1%E5%9E%8B%E8%AF%A6%E8%A7%A3%20-%20Welcome%20to%20AI%20World&amp;text=Transformer%E6%A8%A1%E5%9E%8B%E8%AF%A6%E8%A7%A3&amp;image=https%3A%2F%2Fraw.githubusercontent.com%2Fterrifyzhao%2Fterrifyzhao.github.io%2Fmaster%2Fassets%2Fimg%2F2019-01-06-Transformer%25E6%25A8%25A1%25E5%259E%258B%25E8%25AF%25A6%25E8%25A7%25A3%2Fpic1.png&amp;starid=0&amp;aid=0&amp;style=11" target="_blank"></a><a class="social-share-icon icon-twitter" href="https://twitter.com/intent/tweet?text=Transformer%E6%A8%A1%E5%9E%8B%E8%AF%A6%E8%A7%A3%20-%20Welcome%20to%20AI%20World&amp;url=https%3A%2F%2Fterrifyzhao.github.io%2F2019%2F01%2F11%2FTransformer%25E6%25A8%25A1%25E5%259E%258B%25E8%25AF%25A6%25E8%25A7%25A3.html&amp;via=https%3A%2F%2Fterrifyzhao.github.io" target="_blank"></a></div>
    </div>
    
  </div>

  <section class="author-detail">
    <section class="post-footer-item author-card">
      <div class="avatar">
        <img src="Transformer%E6%A8%A1%E5%9E%8B%E8%AF%A6%E8%A7%A3%20-%20Welcome%20to%20AI%20World_files/profile.jpeg" alt="">
      </div>
      <div class="author-name" rel="author">Joe</div>
      <div class="bio">
        <p>LOVE AI</p>
      </div>
      
      <ul class="sns-links">
        
        <li>
          <a href="mailto:zjiuzhou@gmail.com" target="_blank">
                    <i class="iconfont icon-email"></i>
                </a>
        </li>
        
        <li>
          <a href="https://weibo.com/u/2265751480?refer_flag=1001030101_" target="_blank">
                    <i class="iconfont icon-weibo"></i>
                </a>
        </li>
        
        <li>
          <a href="https://www.linkedin.com/in/%E4%B9%9D%E5%B7%9E-%E8%B5%B5-742276152/" target="_blank">
                    <i class="iconfont icon-linkedin"></i>
                </a>
        </li>
        
        <li>
          <a href="https://www.instagram.com/joe.zhao520/" target="_blank">
                    <i class="iconfont icon-instagram"></i>
                </a>
        </li>
        
        <li>
          <a href="https://github.com/terrifyzhao" target="_blank">
                    <i class="iconfont icon-github"></i>
                </a>
        </li>
        
      </ul>
      
    </section>
    <section class="post-footer-item read-next">
      
      <div class="read-next-item">
        <a href="https://terrifyzhao.github.io/2019/01/11/Transformer%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB.html" class="read-next-link"></a>
        <section>
          <span>Transformer源码解读</span>
          <p>之前我们一起了解了attention、transformer的原理，本文将会基于github的一个 transfo...</p>
        </section>
        
        <div class="filter"></div>
        <img src="Transformer%E6%A8%A1%E5%9E%8B%E8%AF%A6%E8%A7%A3%20-%20Welcome%20to%20AI%20World_files/cover.jpg" alt="">
        
     </div>
      

      
      <div class="read-next-item">
        <a href="https://terrifyzhao.github.io/2019/01/04/Attention%E6%A8%A1%E5%9E%8B%E8%AF%A6%E8%A7%A3.html" class="read-next-link"></a>
          <section>
            <span>Attention机制详解</span>
            <p>简介</p>
          </section>
          
          <div class="filter"></div>
          <img src="Transformer%E6%A8%A1%E5%9E%8B%E8%AF%A6%E8%A7%A3%20-%20Welcome%20to%20AI%20World_files/cover_002.jpg" alt="">
          
      </div>
      
    </section>

    

    
    <section class="post-footer-item comment">
      <div id="lv-container" data-id="city" data-uid="MTAyMC8zNDAzNi8xMDU3NA">
    <iframe title="livereAd" scrolling="no" src="Transformer%E6%A8%A1%E5%9E%8B%E8%AF%A6%E8%A7%A3%20-%20Welcome%20to%20AI%20World_files/ad.htm" style="min-width: 100%; width: 100px; height: 0px; overflow: visible; border: 0px none; z-index: 124212;" id="lv-ad-713" frameborder="0"></iframe><iframe title="livere-comment" scrolling="no" src="Transformer%E6%A8%A1%E5%9E%8B%E8%AF%A6%E8%A7%A3%20-%20Welcome%20to%20AI%20World_files/city.htm" style="min-width: 100%; width: 100px; height: 1163px; overflow: hidden; border: 0px none; z-index: 124212;" id="lv-comment-766" frameborder="0"></iframe></div></section>
    
  </section>

  
  <!--
Author: Ray-Eldath
refer to:
 - https://github.com/theme-next/hexo-theme-next/blob/master/source/js/src/utils.js
 - https://jingyan.baidu.com/article/b2c186c83ec846c46ef6ff80.html
 - http://www.bkjia.com/jQuery/449205.html
-->
<style media="screen">
  .scroll {
    z-index: 10000;
    display: none;
    width: 56px;
    height: 24px;
    background: #222;
    color: #fff;
    line-height: 24px;
    text-align: center;
    position: fixed;
    right: 30px;
    bottom: 30px;
    cursor: pointer;
    font-size: 14px;
  }
</style>
<div class="scroll">
  <i class="fa fa-arrow-up"></i>
  <span class="scrollpercent"></span><span> %</span>
</div>

<script src="Transformer%E6%A8%A1%E5%9E%8B%E8%AF%A6%E8%A7%A3%20-%20Welcome%20to%20AI%20World_files/util.js"></script>
<script type="text/javascript">
  $(document).ready(function() {
    if (utils.isMobile()) {
      $('.scroll').hide();
      return;
    }
    $(window).scroll(function() {
      let scrollValue = $(window).scrollTop();

      var scrollPercentRounded = Math.round((scrollValue / utils.getContentVisibilityHeight()) * 100);
      var scrollPercentMaxed = (scrollPercentRounded > 100) ? 100 : scrollPercentRounded;

      $('.scrollpercent').html(scrollPercentMaxed);
      scrollValue > 100 ? $('.scroll').fadeIn() : $('.scroll').fadeOut();
    });

    $('.scroll').click(function() {
      $('html, body').animate({
        scrollTop: 0
      }, 300);
    })
  })
</script>



<footer class="g-footer">
  <section>Welcome to AI World ©
  
  
    2017
    -
  
  2019
  </section>
  <section>Powered by <a href="https://jekyllrb.com/">Jekyll</a> | <a href="https://github.com/kaeyleo/jekyll-theme-H2O">Theme H2O</a></section>
</footer>


  <script src="Transformer%E6%A8%A1%E5%9E%8B%E8%AF%A6%E8%A7%A3%20-%20Welcome%20to%20AI%20World_files/social-share.js"></script>
  <script>
    socialShare('.social-share', {
      sites: [
        
          'wechat'
          ,
          
        
          'weibo'
          ,
          
        
          'douban'
          ,
          
        
          'twitter'
          
        
      ],
      wechatQrcodeTitle: "分享到微信朋友圈",
      wechatQrcodeHelper: '<p>扫码后点击右上角</p><p>将本文分享至朋友圈</p>'
    });
  </script>




<script>
    (function(d, s) {
      var j, e = d.getElementsByTagName(s)[0];

      if (typeof LivereTower === 'function') {
        return;
      }

      j = d.createElement(s);
      j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
      j.async = true;

      e.parentNode.insertBefore(j, e);
    })(document, 'script');

  </script>


  <noscript>为正常使用评论功能请激活JavaScript。</noscript>
  <script src="Transformer%E6%A8%A1%E5%9E%8B%E8%AF%A6%E8%A7%A3%20-%20Welcome%20to%20AI%20World_files/prism.js"></script>
  <script src="Transformer%E6%A8%A1%E5%9E%8B%E8%AF%A6%E8%A7%A3%20-%20Welcome%20to%20AI%20World_files/index.js"></script>
  <script type="text/x-mathjax-config;executed=true">
    MathJax.Hub.Config({
      tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"] ],
        displayMath: [ ['$$','$$'], ["\\[","\\]"] ]
      }
    });
  </script>
  <script src="Transformer%E6%A8%A1%E5%9E%8B%E8%AF%A6%E8%A7%A3%20-%20Welcome%20to%20AI%20World_files/MathJax.js" type="text/javascript"></script>
  



<div style="position: absolute; width: 0px; height: 0px; overflow: hidden; padding: 0px; border: 0px none; margin: 0px;"><div id="MathJax_Font_Test" style="position: absolute; visibility: hidden; top: 0px; left: 0px; width: auto; padding: 0px; border: 0px none; margin: 0px; white-space: nowrap; text-align: left; text-indent: 0px; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; font-size: 40px; font-weight: normal; font-style: normal; font-size-adjust: none; font-family: MathJax_Size2, sans-serif;"></div></div></body></html>